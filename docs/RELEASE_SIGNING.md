# Release Signing

USnPw publishes SHA-256 checksum sidecars for release artifacts. CI also produces detached GPG signatures for those checksum files and signs published GHCR images.

## GPG Signatures for Checksum Sidecars
CI signs each `*.sha256` file generated by `tools/release.py` and uploads:
- `*.sha256.asc` (detached ASCII-armored signatures)
- `usnpw-release-publickey.asc` (public key for verification)

Artifact name: `usnpw-signatures`  
Workflow: `.github/workflows/release-artifacts.yml`

### Required Repository Secrets
- `USNPW_GPG_PRIVATE_KEY` (ASCII-armored private key, required)
- `USNPW_GPG_PASSPHRASE` (optional, only for passphrase-protected keys)

The release workflow fails if `USNPW_GPG_PRIVATE_KEY` is missing.

### Consumer Verification Flow
1. Import the public key:
   `gpg --import usnpw-release-publickey.asc`
2. Verify checksum signature:
   `gpg --verify <artifact>.sha256.asc <artifact>.sha256`
3. Verify artifact checksum:
   Linux/macOS: `sha256sum -c <artifact>.sha256`  
   PowerShell: `Get-FileHash <artifact> -Algorithm SHA256`

## Container Image Signing (cosign keyless)
CI signs published image digests using keyless signing (GitHub Actions OIDC).

Workflow: `.github/workflows/container-ghcr.yml`

Behavior:
- Tag publishes: signing on by default.
- Manual `workflow_dispatch`: signing defaults to `true` and can be disabled with `sign=false`.

For keyless verification, confirm the OIDC issuer (`https://token.actions.githubusercontent.com`) and the certificate identity for the expected repository and workflow. If you require a pinned verification policy, define it in deployment documentation and treat it as a formal security boundary.
